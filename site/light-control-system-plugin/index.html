<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Hrithik Verma"><link href=../move-model-direct-ros-plugin/ rel=prev><link href=../light-control-service-way-plugin/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Light Control System Plugin - Gazebo Sim Plugin Tutorial</title><link rel=stylesheet href=../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#light-control-system-plugin class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Gazebo Sim Plugin Tutorial" class="md-header__button md-logo" aria-label="Gazebo Sim Plugin Tutorial" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Gazebo Sim Plugin Tutorial </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Light Control System Plugin </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Gazebo Sim Plugin Tutorial" class="md-nav__button md-logo" aria-label="Gazebo Sim Plugin Tutorial" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Gazebo Sim Plugin Tutorial </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../inital_setup/ class=md-nav__link> <span class=md-ellipsis> Inital Setup For Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../some_cplus_concept/ class=md-nav__link> <span class=md-ellipsis> Some C++ Concepts </span> </a> </li> <li class=md-nav__item> <a href=../gz-structure-plugin-perspective/ class=md-nav__link> <span class=md-ellipsis> Gazebo Structure (Plugin Perspective) </span> </a> </li> <li class=md-nav__item> <a href=../what-is-ecs/ class=md-nav__link> <span class=md-ellipsis> What Is Entity Component System? </span> </a> </li> <li class=md-nav__item> <a href=../system-plugin-interfaces/ class=md-nav__link> <span class=md-ellipsis> System Plugin Interfaces </span> </a> </li> <li class=md-nav__item> <a href=../common-code-system-plugin/ class=md-nav__link> <span class=md-ellipsis> Common Code Snap Of System Plugin </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Standalone Gazebo Sim Plugin </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Standalone Gazebo Sim Plugin </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../common-in-all-system.plugin/ class=md-nav__link> <span class=md-ellipsis> Common In All System Plugin </span> </a> </li> <li class=md-nav__item> <a href=../print-entity-system-plugin/ class=md-nav__link> <span class=md-ellipsis> Print Entity System Plugin </span> </a> </li> <li class=md-nav__item> <a href=../move-model/ class=md-nav__link> <span class=md-ellipsis> Move Model System Plugin </span> </a> </li> <li class=md-nav__item> <a href=../movemodel_using_topic/ class=md-nav__link> <span class=md-ellipsis> Move Model Topic Way System PLugin </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex> <span class=md-ellipsis> ROS2_WS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=true> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> ROS2_WS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../common-in-all-ros2-ws-plugins/ class=md-nav__link> <span class=md-ellipsis> Common In All Ros2 Ws Plugins </span> </a> </li> <li class=md-nav__item> <a href=../movemodel_using-ros-gazebo-bridge/ class=md-nav__link> <span class=md-ellipsis> Move Model Using ros-gz-bridge </span> </a> </li> <li class=md-nav__item> <a href=../move-model-direct-ros-plugin/ class=md-nav__link> <span class=md-ellipsis> Move Model Using Direct ROS2 Plugin </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Light Control System Plugin </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Light Control System Plugin </span> </a> <nav class="md-nav md-nav--secondary" aria-label="On this page"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> On this page </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#light-control-logic class=md-nav__link> <span class=md-ellipsis> Light Control Logic </span> </a> </li> <li class=md-nav__item> <a href=#how-colour-change-works class=md-nav__link> <span class=md-ellipsis> How Colour Change works </span> </a> </li> <li class=md-nav__item> <a href=#how-to-get-multiple-entities class=md-nav__link> <span class=md-ellipsis> How To Get Multiple Entities </span> </a> </li> <li class=md-nav__item> <a href=#update-component-values class=md-nav__link> <span class=md-ellipsis> Update Component Values </span> </a> </li> <li class=md-nav__item> <a href=#convert-data-type class=md-nav__link> <span class=md-ellipsis> Convert Data Type </span> </a> </li> <li class=md-nav__item> <a href=#set-new-colour class=md-nav__link> <span class=md-ellipsis> Set New Colour </span> </a> </li> <li class=md-nav__item> <a href=#full-plugin class=md-nav__link> <span class=md-ellipsis> Full Plugin </span> </a> </li> <li class=md-nav__item> <a href=#flicker-effect-disco-effect class=md-nav__link> <span class=md-ellipsis> flicker Effect (Disco effect) </span> </a> </li> <li class=md-nav__item> <a href=#other-way-possible-using-light-class-doesnt-work-as-expected-why class=md-nav__link> <span class=md-ellipsis> Other Way Possible Using Light Class Doesn't work As Expected Why? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../light-control-service-way-plugin/ class=md-nav__link> <span class=md-ellipsis> Light Control Service Way </span> </a> </li> <li class=md-nav__item> <a href=../light-control-direct-ros-plugin/ class=md-nav__link> <span class=md-ellipsis> Light Control Using Direct ROS2 Plugin </span> </a> </li> <li class=md-nav__item> <a href=../joint-control-system-plugin/ class=md-nav__link> <span class=md-ellipsis> Joint Control System Plugin </span> </a> </li> <li class=md-nav__item> <a href=../animal-actor-follow-waypoints-plugin/ class=md-nav__link> <span class=md-ellipsis> Animal Actor Follow WayPoint Plugin </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../example-from-gazebo-sim-repo-and-pro-tips/ class=md-nav__link> <span class=md-ellipsis> Real Gazebo Sim Repo Examples + Pro Tips, Pimpl Pattern </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=light-control-system-plugin>Light Control System Plugin<a class=headerlink href=#light-control-system-plugin title="Permanent link">&para;</a></h1> <p><iframe width=960 height=540 src="https://www.youtube.com/embed/L9-3nozt4ac?si=nuf9BloEaf7h2vGa" title="Gazebo Sim Structure Plugin Perspective" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen> </iframe> </p> <p>In this tutorial we make a light control system plugin. Will use 2 spot light to make disco light effect</p> <p><img alt=light src=../assets/images/sportlights_gz.png></p> <p><br></p> <h2 id=light-control-logic>Light Control Logic<a class=headerlink href=#light-control-logic title="Permanent link">&para;</a></h2> <p><img alt="gz light components" src=../assets/images/gz-light-component.png></p> <ul> <li>Read the 2 light component current value</li> <li>change only the <code>diffuse &amp; specular</code> colour rgb value</li> <li>Update the colours on every loop</li> </ul> <p><br></p> <h2 id=how-colour-change-works>How Colour Change works<a class=headerlink href=#how-colour-change-works title="Permanent link">&para;</a></h2> <p><a href=https://www.desmos.com/calculator/akwxcaxt57>graph link</a></p> <p><img alt="light graph" src=../assets/images/light_graph.png></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=w>    </span><span class=c1>// Animated RGB in [0,1]</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=p>));</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>2.0</span><span class=p>));</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>4.0</span><span class=p>));</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=n>gz</span><span class=o>::</span><span class=n>math</span><span class=o>::</span><span class=n>Color</span><span class=w> </span><span class=nf>newColor</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
</code></pre></div> <p><br> <br></p> <h2 id=how-to-get-multiple-entities>How To Get Multiple Entities<a class=headerlink href=#how-to-get-multiple-entities title="Permanent link">&para;</a></h2> <p><img alt=each src=../assets/images/each.png></p> <p><img alt="detail each" src=../assets/images/details_each.png></p> <p>related api in <a href=https://gazebosim.org/api/sim/9/classgz_1_1sim_1_1EntityComponentManager.html>EntityComponentManager class</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>//check for such components which has Light, Name components</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>_ecm</span><span class=p>.</span><span class=n>Each</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>Light</span><span class=p>,</span><span class=w> </span><span class=n>components</span><span class=o>::</span><span class=n>Name</span><span class=o>&gt;</span><span class=p>(</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span><span class=w> </span><span class=n>Entity</span><span class=w> </span><span class=o>&amp;</span><span class=n>_entity</span><span class=p>,</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>        </span><span class=k>const</span><span class=w> </span><span class=n>components</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=o>*</span><span class=p>,</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>        </span><span class=k>const</span><span class=w> </span><span class=n>components</span><span class=o>::</span><span class=n>Name</span><span class=w> </span><span class=o>*</span><span class=n>_name</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=kt>bool</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>lightEntites</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>_entity</span><span class=p>);</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=c1>// gzmsg &lt;&lt; &quot;Found light: &quot; &lt;&lt; _name-&gt;Data()</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=c1>//       &lt;&lt; &quot; (entity &quot; &lt;&lt; _entity &lt;&lt; &quot;)\n&quot;;</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=p>});</span>
</code></pre></div> <p><br> <br></p> <h2 id=update-component-values>Update Component Values<a class=headerlink href=#update-component-values title="Permanent link">&para;</a></h2> <p>lets first see the all available <a href=https://gazebosim.org/api/sim/9/namespacegz_1_1sim_1_1components.html>components</a> for light</p> <p><img alt="light components" src=../assets/images/light_components.png></p> <p><code>LightCmd</code> has <code>Cmd</code> we can use it command/control the light plugin </p> <p><br></p> <h2 id=convert-data-type>Convert Data Type<a class=headerlink href=#convert-data-type title="Permanent link">&para;</a></h2> <p>what is the data type of it? <br></p> <p><code>components::Light</code> - <code>sdf::Light</code> data type <br> <code>components::LightCmd</code> - <code>gz::msgs::Light</code> data type <br></p> <p>both has a different data type means we need to convert between them</p> <p><img alt="convert msg" src=../assets/images/convert_light_msg.png></p> <p>related api in <a href=https://gazebosim.org/api/sim/9/namespacegz_1_1sim.html>gz::sim</a> ,<a href=https://gazebosim.org/api/msgs/10/namespacegz_1_1msgs.html>gz::msgs api</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>auto</span><span class=w> </span><span class=n>lightComp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_ecm</span><span class=p>.</span><span class=n>Component</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>Light</span><span class=o>&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=k>const</span><span class=w> </span><span class=n>sdf</span><span class=o>::</span><span class=n>v14</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=o>&amp;</span><span class=n>sdfLight</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lightComp</span><span class=o>-&gt;</span><span class=n>Data</span><span class=p>();</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1>//convert sdf light msg to gz light msg</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gz</span><span class=o>::</span><span class=n>sim</span><span class=o>::</span><span class=n>convert</span><span class=o>&lt;</span><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Light</span><span class=o>&gt;</span><span class=p>(</span><span class=n>sdfLight</span><span class=p>);</span>
</code></pre></div> <p><br> <br></p> <h2 id=set-new-colour>Set New Colour<a class=headerlink href=#set-new-colour title="Permanent link">&para;</a></h2> <p>Inside <a href=https://gazebosim.org/api/msgs/9/classgz_1_1msgs_1_1Light.html>gz::sim::light</a> class</p> <p>diffuses &amp; specular both msg are of type <code>gz::msgs::Color</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>gz</span><span class=o>::</span><span class=n>math</span><span class=o>::</span><span class=n>Color</span><span class=w> </span><span class=nf>newColor</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1>//using Set() to set the fields of light msg</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Set</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=n>mutable_diffuse</span><span class=p>(),</span><span class=w>  </span><span class=n>newColor</span><span class=p>);</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Set</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=n>mutable_specular</span><span class=p>(),</span><span class=w> </span><span class=n>newColor</span><span class=p>);</span>
</code></pre></div> <p><img alt="diffusion msg" src=../assets/images/diffuse_msg.png></p> <p><img alt="specular msg" src=../assets/images/specular_msg.png></p> <p>that is why we can use <code>gz::msgs::Set()</code> to set <code>gz::math::Color</code> values</p> <p><img alt="math colour" src=../assets/images/math-colour.png></p> <p><br> set the LightCmd Component, its same method that we dicussed in <a href=../move-model/ >MoveModel System Plugin</a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>//method1</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=c1>// auto cmdComp = _ecm.Component&lt;components::LightCmd&gt;(e);</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c1>// if (!cmdComp)</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1>//   _ecm.CreateComponent(e, components::LightCmd(msg));</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1>// else</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=c1>// {</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=c1>//   cmdComp-&gt;Data() = msg;</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=c1>// }</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=c1>//method2</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=n>_ecm</span><span class=p>.</span><span class=n>SetComponentData</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=o>&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=n>msg</span><span class=p>);</span>
</code></pre></div> <p>in case of light we need to trigger update so that rendering system knows it updated but it case of all physics related plugin it auto updates like in case of Move Model velocity get auto updated.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>SetChanged</span><span class=p>(</span><span class=n>e</span><span class=p>,</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>                    </span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=o>::</span><span class=n>typeId</span><span class=p>,</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>                    </span><span class=n>ComponentState</span><span class=o>::</span><span class=n>PeriodicChange</span><span class=p>);</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>                    </span><span class=c1>/// PeriodicChange -&gt;changing periodically,ok to drop few samples</span>
</code></pre></div> <p><img alt=set_changed src=../assets/images/set_changed.png></p> <h2 id=full-plugin>Full Plugin<a class=headerlink href=#full-plugin title="Permanent link">&para;</a></h2> <details> <summary>plugin .sdf file</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=cm>&lt;!-- custom plugin to make disco light effect--&gt;</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nt>&lt;plugin</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=na>filename=</span><span class=s>&quot;LightControl&quot;</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=na>name=</span><span class=s>&quot;gz::sim::LightControl&quot;</span><span class=nt>&gt;</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=nt>&lt;/plugin&gt;</span>
</code></pre></div> </details> <details> <summary>.hh file</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=cp>#ifndef LIGHT_CONTROL_PLUGIN_HH_</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=cp>#define LIGHT_CONTROL_PLUGIN_HH_</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/System.hh&gt;</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/components/Name.hh&gt;</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/components/Light.hh&gt;</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/math/Color.hh&gt;</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/Light.hh&gt;</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;vector&gt;</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=k>namespace</span><span class=w> </span><span class=nn>gz</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=p>{</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=k>namespace</span><span class=w> </span><span class=nn>sim</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=p>{</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=k>class</span><span class=w> </span><span class=nc>LightControl</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>System</span><span class=p>,</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>ISystemPreUpdate</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=p>{</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=k>public</span><span class=o>:</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>  </span><span class=c1>// Constructor</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=w>  </span><span class=n>LightControl</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>default</span><span class=p>;</span>
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=w>  </span><span class=c1>// ISystemPreUpdate method</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=nf>PreUpdate</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>UpdateInfo</span><span class=w> </span><span class=o>&amp;</span><span class=n>_info</span><span class=p>,</span><span class=w> </span><span class=n>EntityComponentManager</span><span class=w> </span><span class=o>&amp;</span><span class=n>_ecm</span><span class=p>)</span><span class=w> </span><span class=k>override</span><span class=p>;</span>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=k>private</span><span class=o>:</span>
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a><span class=w>  </span><span class=c1>// Function to find the light entity by name</span>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=w>  </span><span class=kt>void</span><span class=w> </span><span class=n>FindLightEntities</span><span class=p>(</span><span class=n>EntityComponentManager</span><span class=w> </span><span class=o>&amp;</span><span class=n>_ecm</span><span class=p>);</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=w>  </span><span class=c1>// Time accumulator for color cycling</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=w>  </span><span class=kt>double</span><span class=w> </span><span class=n>time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.0</span><span class=p>;</span>
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=w>  </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Entity</span><span class=o>&gt;</span><span class=w> </span><span class=n>lightEntites</span><span class=p>;</span><span class=w> </span><span class=c1>//list of light entity</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=p>};</span>
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a><span class=p>}</span><span class=w>  </span><span class=c1>// namespace sim</span>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=p>}</span><span class=w>  </span><span class=c1>// namespace gz</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=cp>#endif</span>
</code></pre></div> </details> <details> <summary>.cc file</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&quot;tutorial_gazebo_plugins/LightControl.hh&quot;</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/plugin/Register.hh&gt;</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/msgs/light.pb.h&gt;</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/msgs/Utility.hh&gt;</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/components/Light.hh&gt;</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/components/LightCmd.hh&gt;</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/components/Name.hh&gt;</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;sdf/Light.hh&gt;</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;gz/sim/Conversions.hh&gt;</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>gz</span><span class=p>;</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>gz</span><span class=o>::</span><span class=nn>sim</span><span class=p>;</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=c1>// Find all light entities</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=kt>void</span><span class=w> </span><span class=nf>LightControl::FindLightEntities</span><span class=p>(</span><span class=n>EntityComponentManager</span><span class=w> </span><span class=o>&amp;</span><span class=n>_ecm</span><span class=p>)</span>
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=p>{</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=w>  </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>lightEntites</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=w>  </span><span class=c1>//check for such components which has Light, Name components</span>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=w>  </span><span class=n>_ecm</span><span class=p>.</span><span class=n>Each</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>Light</span><span class=p>,</span><span class=w> </span><span class=n>components</span><span class=o>::</span><span class=n>Name</span><span class=o>&gt;</span><span class=p>(</span>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=w>      </span><span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>const</span><span class=w> </span><span class=n>Entity</span><span class=w> </span><span class=o>&amp;</span><span class=n>_entity</span><span class=p>,</span>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=w>          </span><span class=k>const</span><span class=w> </span><span class=n>components</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=o>*</span><span class=p>,</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=w>          </span><span class=k>const</span><span class=w> </span><span class=n>components</span><span class=o>::</span><span class=n>Name</span><span class=w> </span><span class=o>*</span><span class=n>_name</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=kt>bool</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=w>      </span><span class=p>{</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=w>        </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>lightEntites</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>_entity</span><span class=p>);</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=w>        </span><span class=c1>// gzmsg &lt;&lt; &quot;Found light: &quot; &lt;&lt; _name-&gt;Data()</span>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=w>        </span><span class=c1>//       &lt;&lt; &quot; (entity &quot; &lt;&lt; _entity &lt;&lt; &quot;)\n&quot;;</span>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>true</span><span class=p>;</span>
<a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=w>      </span><span class=p>});</span>
<a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=p>}</span>
<a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a>
<a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=c1>// ---------------------------------------------------------------------</span>
<a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=kt>void</span><span class=w> </span><span class=nf>LightControl::PreUpdate</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>UpdateInfo</span><span class=w> </span><span class=o>&amp;</span><span class=n>_info</span><span class=p>,</span>
<a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=w>                             </span><span class=n>EntityComponentManager</span><span class=w> </span><span class=o>&amp;</span><span class=n>_ecm</span><span class=p>)</span>
<a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=p>{</span>
<a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=w>   </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>_info</span><span class=p>.</span><span class=n>paused</span><span class=p>)</span>
<a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=w>    </span><span class=k>return</span><span class=p>;</span>
<a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a>
<a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a><span class=w>  </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;&gt;</span><span class=p>(</span>
<a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a><span class=w>                    </span><span class=n>_info</span><span class=p>.</span><span class=n>dt</span><span class=p>)</span>
<a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a><span class=w>                    </span><span class=p>.</span><span class=n>count</span><span class=p>();</span>
<a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a>
<a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a><span class=w>  </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>FindLightEntities</span><span class=p>(</span><span class=n>_ecm</span><span class=p>);</span>
<a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>lightEntites</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span>
<a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a><span class=w>    </span><span class=k>return</span><span class=p>;</span>
<a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a>
<a id=__codelineno-8-54 name=__codelineno-8-54 href=#__codelineno-8-54></a><span class=w>  </span><span class=c1>//Un comment to see the flicker effect</span>
<a id=__codelineno-8-55 name=__codelineno-8-55 href=#__codelineno-8-55></a><span class=w>  </span><span class=c1>// Flicker (no RNG): irregular brightness 0.15..1.0</span>
<a id=__codelineno-8-56 name=__codelineno-8-56 href=#__codelineno-8-56></a><span class=w>  </span><span class=c1>// constexpr double kTwoPi = 6.283185307179586;</span>
<a id=__codelineno-8-57 name=__codelineno-8-57 href=#__codelineno-8-57></a><span class=w>  </span><span class=c1>// const double t = this-&gt;time;</span>
<a id=__codelineno-8-58 name=__codelineno-8-58 href=#__codelineno-8-58></a>
<a id=__codelineno-8-59 name=__codelineno-8-59 href=#__codelineno-8-59></a><span class=w>  </span><span class=c1>// double flicker = 0.55</span>
<a id=__codelineno-8-60 name=__codelineno-8-60 href=#__codelineno-8-60></a><span class=w>  </span><span class=c1>//   + 0.25 * std::sin(kTwoPi * 17.0 * t)</span>
<a id=__codelineno-8-61 name=__codelineno-8-61 href=#__codelineno-8-61></a><span class=w>  </span><span class=c1>//   + 0.15 * std::sin(kTwoPi * 23.0 * t + 1.7)</span>
<a id=__codelineno-8-62 name=__codelineno-8-62 href=#__codelineno-8-62></a><span class=w>  </span><span class=c1>//   + 0.10 * std::sin(kTwoPi * 31.0 * t + 0.3);</span>
<a id=__codelineno-8-63 name=__codelineno-8-63 href=#__codelineno-8-63></a>
<a id=__codelineno-8-64 name=__codelineno-8-64 href=#__codelineno-8-64></a>
<a id=__codelineno-8-65 name=__codelineno-8-65 href=#__codelineno-8-65></a><span class=w>  </span><span class=c1>// flicker = std::clamp(flicker, 0.15, 1.0);</span>
<a id=__codelineno-8-66 name=__codelineno-8-66 href=#__codelineno-8-66></a>
<a id=__codelineno-8-67 name=__codelineno-8-67 href=#__codelineno-8-67></a><span class=w>  </span><span class=c1>// // // Animated RGB in [0,1]</span>
<a id=__codelineno-8-68 name=__codelineno-8-68 href=#__codelineno-8-68></a><span class=w>  </span><span class=c1>// const double r = 0.5 * (1.0 + std::sin(this-&gt;time * 0.5)) * flicker;</span>
<a id=__codelineno-8-69 name=__codelineno-8-69 href=#__codelineno-8-69></a><span class=w>  </span><span class=c1>// const double g = 0.5 * (1.0 + std::sin(this-&gt;time * 0.5 + 2.0)) * flicker;</span>
<a id=__codelineno-8-70 name=__codelineno-8-70 href=#__codelineno-8-70></a><span class=w>  </span><span class=c1>// const double b = 0.5 * (1.0 + std::sin(this-&gt;time * 0.5 + 4.0)) * flicker;</span>
<a id=__codelineno-8-71 name=__codelineno-8-71 href=#__codelineno-8-71></a><span class=w>  </span><span class=c1>// gz::math::Color newColor(r, g, b, 1.0);</span>
<a id=__codelineno-8-72 name=__codelineno-8-72 href=#__codelineno-8-72></a>
<a id=__codelineno-8-73 name=__codelineno-8-73 href=#__codelineno-8-73></a><span class=w>  </span><span class=c1>// Animated RGB in [0,1]</span>
<a id=__codelineno-8-74 name=__codelineno-8-74 href=#__codelineno-8-74></a><span class=w>  </span><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=p>));</span>
<a id=__codelineno-8-75 name=__codelineno-8-75 href=#__codelineno-8-75></a><span class=w>  </span><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>2.0</span><span class=p>));</span>
<a id=__codelineno-8-76 name=__codelineno-8-76 href=#__codelineno-8-76></a><span class=w>  </span><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>4.0</span><span class=p>));</span>
<a id=__codelineno-8-77 name=__codelineno-8-77 href=#__codelineno-8-77></a><span class=w>  </span><span class=n>gz</span><span class=o>::</span><span class=n>math</span><span class=o>::</span><span class=n>Color</span><span class=w> </span><span class=n>newColor</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
<a id=__codelineno-8-78 name=__codelineno-8-78 href=#__codelineno-8-78></a>
<a id=__codelineno-8-79 name=__codelineno-8-79 href=#__codelineno-8-79></a>
<a id=__codelineno-8-80 name=__codelineno-8-80 href=#__codelineno-8-80></a>
<a id=__codelineno-8-81 name=__codelineno-8-81 href=#__codelineno-8-81></a><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>Entity</span><span class=w> </span><span class=n>e</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>lightEntites</span><span class=p>)</span>
<a id=__codelineno-8-82 name=__codelineno-8-82 href=#__codelineno-8-82></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-8-83 name=__codelineno-8-83 href=#__codelineno-8-83></a>
<a id=__codelineno-8-84 name=__codelineno-8-84 href=#__codelineno-8-84></a><span class=w>    </span><span class=c1>//read data of Light</span>
<a id=__codelineno-8-85 name=__codelineno-8-85 href=#__codelineno-8-85></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>lightComp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>_ecm</span><span class=p>.</span><span class=n>Component</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>Light</span><span class=o>&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
<a id=__codelineno-8-86 name=__codelineno-8-86 href=#__codelineno-8-86></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>lightComp</span><span class=p>)</span>
<a id=__codelineno-8-87 name=__codelineno-8-87 href=#__codelineno-8-87></a><span class=w>      </span><span class=k>continue</span><span class=p>;</span>
<a id=__codelineno-8-88 name=__codelineno-8-88 href=#__codelineno-8-88></a>
<a id=__codelineno-8-89 name=__codelineno-8-89 href=#__codelineno-8-89></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=n>sdf</span><span class=o>::</span><span class=n>v14</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=o>&amp;</span><span class=n>sdfLight</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lightComp</span><span class=o>-&gt;</span><span class=n>Data</span><span class=p>();</span>
<a id=__codelineno-8-90 name=__codelineno-8-90 href=#__codelineno-8-90></a>
<a id=__codelineno-8-91 name=__codelineno-8-91 href=#__codelineno-8-91></a><span class=w>    </span><span class=c1>//convert sdf light msg to gz light msg</span>
<a id=__codelineno-8-92 name=__codelineno-8-92 href=#__codelineno-8-92></a><span class=w>    </span><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>gz</span><span class=o>::</span><span class=n>sim</span><span class=o>::</span><span class=n>convert</span><span class=o>&lt;</span><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Light</span><span class=o>&gt;</span><span class=p>(</span><span class=n>sdfLight</span><span class=p>);</span>
<a id=__codelineno-8-93 name=__codelineno-8-93 href=#__codelineno-8-93></a>
<a id=__codelineno-8-94 name=__codelineno-8-94 href=#__codelineno-8-94></a><span class=w>    </span><span class=c1>//using Set() to set the fields of light msg</span>
<a id=__codelineno-8-95 name=__codelineno-8-95 href=#__codelineno-8-95></a><span class=w>    </span><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Set</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=n>mutable_diffuse</span><span class=p>(),</span><span class=w>  </span><span class=n>newColor</span><span class=p>);</span>
<a id=__codelineno-8-96 name=__codelineno-8-96 href=#__codelineno-8-96></a><span class=w>    </span><span class=n>gz</span><span class=o>::</span><span class=n>msgs</span><span class=o>::</span><span class=n>Set</span><span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=n>mutable_specular</span><span class=p>(),</span><span class=w> </span><span class=n>newColor</span><span class=p>);</span>
<a id=__codelineno-8-97 name=__codelineno-8-97 href=#__codelineno-8-97></a>
<a id=__codelineno-8-98 name=__codelineno-8-98 href=#__codelineno-8-98></a><span class=w>    </span><span class=c1>//method1</span>
<a id=__codelineno-8-99 name=__codelineno-8-99 href=#__codelineno-8-99></a><span class=w>    </span><span class=c1>// auto cmdComp = _ecm.Component&lt;components::LightCmd&gt;(e);</span>
<a id=__codelineno-8-100 name=__codelineno-8-100 href=#__codelineno-8-100></a><span class=w>    </span><span class=c1>// if (!cmdComp)</span>
<a id=__codelineno-8-101 name=__codelineno-8-101 href=#__codelineno-8-101></a><span class=w>    </span><span class=c1>//   _ecm.CreateComponent(e, components::LightCmd(msg));</span>
<a id=__codelineno-8-102 name=__codelineno-8-102 href=#__codelineno-8-102></a><span class=w>    </span><span class=c1>// else</span>
<a id=__codelineno-8-103 name=__codelineno-8-103 href=#__codelineno-8-103></a><span class=w>    </span><span class=c1>// {</span>
<a id=__codelineno-8-104 name=__codelineno-8-104 href=#__codelineno-8-104></a>
<a id=__codelineno-8-105 name=__codelineno-8-105 href=#__codelineno-8-105></a><span class=w>    </span><span class=c1>//   cmdComp-&gt;Data() = msg;</span>
<a id=__codelineno-8-106 name=__codelineno-8-106 href=#__codelineno-8-106></a>
<a id=__codelineno-8-107 name=__codelineno-8-107 href=#__codelineno-8-107></a>
<a id=__codelineno-8-108 name=__codelineno-8-108 href=#__codelineno-8-108></a><span class=w>    </span><span class=c1>// }</span>
<a id=__codelineno-8-109 name=__codelineno-8-109 href=#__codelineno-8-109></a>
<a id=__codelineno-8-110 name=__codelineno-8-110 href=#__codelineno-8-110></a><span class=w>    </span><span class=c1>//method2</span>
<a id=__codelineno-8-111 name=__codelineno-8-111 href=#__codelineno-8-111></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>SetComponentData</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=o>&gt;</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=n>msg</span><span class=p>);</span>
<a id=__codelineno-8-112 name=__codelineno-8-112 href=#__codelineno-8-112></a>
<a id=__codelineno-8-113 name=__codelineno-8-113 href=#__codelineno-8-113></a><span class=w>    </span><span class=c1>// in case of light we need to trigger update so that rendering system knows it updated</span>
<a id=__codelineno-8-114 name=__codelineno-8-114 href=#__codelineno-8-114></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>SetChanged</span><span class=p>(</span><span class=n>e</span><span class=p>,</span>
<a id=__codelineno-8-115 name=__codelineno-8-115 href=#__codelineno-8-115></a><span class=w>                    </span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=o>::</span><span class=n>typeId</span><span class=p>,</span>
<a id=__codelineno-8-116 name=__codelineno-8-116 href=#__codelineno-8-116></a><span class=w>                    </span><span class=n>ComponentState</span><span class=o>::</span><span class=n>PeriodicChange</span><span class=p>);</span>
<a id=__codelineno-8-117 name=__codelineno-8-117 href=#__codelineno-8-117></a><span class=w>                    </span><span class=c1>/// PeriodicChange -&gt;changing periodically,ok to drop few samples</span>
<a id=__codelineno-8-118 name=__codelineno-8-118 href=#__codelineno-8-118></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-8-119 name=__codelineno-8-119 href=#__codelineno-8-119></a><span class=p>}</span>
<a id=__codelineno-8-120 name=__codelineno-8-120 href=#__codelineno-8-120></a>
<a id=__codelineno-8-121 name=__codelineno-8-121 href=#__codelineno-8-121></a><span class=c1>// Register the plugin</span>
<a id=__codelineno-8-122 name=__codelineno-8-122 href=#__codelineno-8-122></a><span class=n>GZ_ADD_PLUGIN</span><span class=p>(</span>
<a id=__codelineno-8-123 name=__codelineno-8-123 href=#__codelineno-8-123></a><span class=w>    </span><span class=n>LightControl</span><span class=p>,</span>
<a id=__codelineno-8-124 name=__codelineno-8-124 href=#__codelineno-8-124></a><span class=w>    </span><span class=n>gz</span><span class=o>::</span><span class=n>sim</span><span class=o>::</span><span class=n>System</span><span class=p>,</span>
<a id=__codelineno-8-125 name=__codelineno-8-125 href=#__codelineno-8-125></a><span class=w>    </span><span class=n>LightControl</span><span class=o>::</span><span class=n>ISystemPreUpdate</span><span class=p>)</span>
<a id=__codelineno-8-126 name=__codelineno-8-126 href=#__codelineno-8-126></a>
<a id=__codelineno-8-127 name=__codelineno-8-127 href=#__codelineno-8-127></a><span class=n>GZ_ADD_PLUGIN_ALIAS</span><span class=p>(</span><span class=n>LightControl</span><span class=p>,</span><span class=w> </span><span class=s>&quot;gz::sim::LightControl&quot;</span><span class=p>)</span>
</code></pre></div> </details> <h2 id=flicker-effect-disco-effect>flicker Effect (Disco effect)<a class=headerlink href=#flicker-effect-disco-effect title="Permanent link">&para;</a></h2> <p>making light intensity low/light give the disco effect</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>//Un comment to see the flicker effect</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=c1>// Flicker (no RNG): irregular brightness 0.15..1.0</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>constexpr</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>kTwoPi</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>6.283185307179586</span><span class=p>;</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=p>;</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=kt>double</span><span class=w> </span><span class=n>flicker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.55</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>  </span><span class=o>+</span><span class=w> </span><span class=mf>0.25</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=n>kTwoPi</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>17.0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>t</span><span class=p>)</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>  </span><span class=o>+</span><span class=w> </span><span class=mf>0.15</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=n>kTwoPi</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>23.0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1.7</span><span class=p>)</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>  </span><span class=o>+</span><span class=w> </span><span class=mf>0.10</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=n>kTwoPi</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>31.0</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>0.3</span><span class=p>);</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=n>flicker</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>clamp</span><span class=p>(</span><span class=n>flicker</span><span class=p>,</span><span class=w> </span><span class=mf>0.15</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>
<a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=c1>// // Animated RGB in [0,1]</span>
<a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=p>))</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>flicker</span><span class=p>;</span>
<a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>2.0</span><span class=p>))</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>flicker</span><span class=p>;</span>
<a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=k>const</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mf>1.0</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>sin</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>time</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mf>0.5</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>4.0</span><span class=p>))</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>flicker</span><span class=p>;</span>
<a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=n>gz</span><span class=o>::</span><span class=n>math</span><span class=o>::</span><span class=n>Color</span><span class=w> </span><span class=nf>newColor</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=w> </span><span class=n>g</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
</code></pre></div> <h2 id=other-way-possible-using-light-class-doesnt-work-as-expected-why>Other Way Possible Using Light Class Doesn't work As Expected Why?<a class=headerlink href=#other-way-possible-using-light-class-doesnt-work-as-expected-why title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=k>auto</span><span class=w> </span><span class=n>lightObj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Light</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>lightObj</span><span class=p>.</span><span class=n>SetDiffuseColor</span><span class=p>(</span><span class=n>_ecm</span><span class=p>,</span><span class=w> </span><span class=n>newColor</span><span class=p>);</span><span class=w> </span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=n>lightObj</span><span class=p>.</span><span class=n>SetSpecularColor</span><span class=p>(</span><span class=n>_ecm</span><span class=p>,</span><span class=w> </span><span class=n>newColor</span><span class=p>);</span>
</code></pre></div> <p>if gazebo sim github <a href=https://github.com/gazebosim/gz-sim/blob/gz-sim10/src/Light.cc>Light.cc</a> actual code you will understand why</p> <details> <summary>actual api code</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kt>void</span><span class=w> </span><span class=nf>Light::SetDiffuseColor</span><span class=p>(</span><span class=n>EntityComponentManager</span><span class=w> </span><span class=o>&amp;</span><span class=n>_ecm</span><span class=p>,</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>   </span><span class=k>const</span><span class=w> </span><span class=n>math</span><span class=o>::</span><span class=n>Color</span><span class=w> </span><span class=o>&amp;</span><span class=n>_color</span><span class=p>)</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=p>{</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>lightCmd</span><span class=w> </span><span class=o>=</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>Component</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=o>&gt;</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>dataPtr</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>);</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>  </span><span class=n>msgs</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=n>lightMsg</span><span class=p>;</span><span class=w>   </span><span class=c1>///problem is here it created a entire new msg</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>  </span><span class=n>msgs</span><span class=o>::</span><span class=n>Set</span><span class=p>(</span><span class=n>lightMsg</span><span class=p>.</span><span class=n>mutable_diffuse</span><span class=p>(),</span><span class=w> </span><span class=n>_color</span><span class=p>);</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>lightCmd</span><span class=p>)</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>CreateComponent</span><span class=p>(</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>        </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>dataPtr</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>,</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>        </span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=p>(</span><span class=n>lightMsg</span><span class=p>));</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>  </span><span class=k>else</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=w>    </span><span class=n>lightCmd</span><span class=o>-&gt;</span><span class=n>Data</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lightMsg</span><span class=p>;</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kt>void</span><span class=w> </span><span class=nf>Light::SetSpecularColor</span><span class=p>(</span><span class=n>EntityComponentManager</span><span class=w> </span><span class=o>&amp;</span><span class=n>_ecm</span><span class=p>,</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>   </span><span class=k>const</span><span class=w> </span><span class=n>math</span><span class=o>::</span><span class=n>Color</span><span class=w> </span><span class=o>&amp;</span><span class=n>_color</span><span class=p>)</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=p>{</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>  </span><span class=k>auto</span><span class=w> </span><span class=n>lightCmd</span><span class=w> </span><span class=o>=</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>Component</span><span class=o>&lt;</span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=o>&gt;</span><span class=p>(</span><span class=k>this</span><span class=o>-&gt;</span><span class=n>dataPtr</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>);</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>  </span><span class=n>msgs</span><span class=o>::</span><span class=n>Light</span><span class=w> </span><span class=n>lightMsg</span><span class=p>;</span><span class=w> </span><span class=c1>///problem is here it created a entire new msg</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>  </span><span class=n>msgs</span><span class=o>::</span><span class=n>Set</span><span class=p>(</span><span class=n>lightMsg</span><span class=p>.</span><span class=n>mutable_specular</span><span class=p>(),</span><span class=w> </span><span class=n>_color</span><span class=p>);</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>lightCmd</span><span class=p>)</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=n>_ecm</span><span class=p>.</span><span class=n>CreateComponent</span><span class=p>(</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>        </span><span class=k>this</span><span class=o>-&gt;</span><span class=n>dataPtr</span><span class=o>-&gt;</span><span class=n>id</span><span class=p>,</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>        </span><span class=n>components</span><span class=o>::</span><span class=n>LightCmd</span><span class=p>(</span><span class=n>lightMsg</span><span class=p>));</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>  </span><span class=k>else</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>  </span><span class=p>{</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>    </span><span class=n>lightCmd</span><span class=o>-&gt;</span><span class=n>Data</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lightMsg</span><span class=p>;</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=w>  </span><span class=p>}</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=p>}</span>
</code></pre></div> </details> <p><code>msgs::Light lightMsg;</code> problem is here it created a entire new msg means new light because of which we can change our light certain color property rather end up making new light so be very carefull using direct class of <code>model,world,light</code> etc</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../move-model-direct-ros-plugin/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Move Model Using Direct ROS2 Plugin"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Move Model Using Direct ROS2 Plugin </div> </div> </a> <a href=../light-control-service-way-plugin/ class="md-footer__link md-footer__link--next" aria-label="Next: Light Control Service Way"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Light Control Service Way </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Hrithik Verma </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://www.linkedin.com/in/hrithik-verma-35a155193 target=_blank rel=noopener title=LinkedIn class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href="https://www.instagram.com/hrithik.verma.100/?hl=en" target=_blank rel=noopener title=Instagram class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224.3 141a115 115 0 1 0-.6 230 115 115 0 1 0 .6-230m-.6 40.4a74.6 74.6 0 1 1 .6 149.2 74.6 74.6 0 1 1-.6-149.2m93.4-45.1a26.8 26.8 0 1 1 53.6 0 26.8 26.8 0 1 1-53.6 0m129.7 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8M399 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1"/></svg> </a> <a href=https://www.youtube.com/@RoboticsWithHrithik target=_blank rel=noopener title=YouTube class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.instant.progress", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips", "header.autohide"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.e71a0d61.min.js></script> </body> </html>